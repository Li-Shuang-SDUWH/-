## 温控风扇程序

### 主函数程序

电机开------设置初始上下限值------初始化eeprom------读取当前温度值------定时器初始化，打开中断------设置上下限值，判断当前档位-------中断5ms溢出一次，溢出后，根据档位调节占空比------并且进行数码管动态扫描显示温度-------中断50次之后，即每隔一秒钟读取一次温度。

#### 1.温度传感器

- 基本流程：
  - 温度转换函数，让温度传感器开始转换
    - 用到温度转换命令
  - 温度读取函数
    - 用到温度读取命令
  - 读取总线上的温度值（16个字节）分两次
    - 用到温度读取函数
  - 存储温度值并进行计算

> 向温度传感器发送命令时要先初始化（用到初始化函数）
>
> 发送命令要用到向温度传感器写入字节的函数

- - 除此之外，基本所有都会用到延时函数

#### 2.EEPROM电子抹除式可复写只读存储器

- 宏晶STC很多系列的单片机片内都集成了EEPROM存储器，STC89C52单片机内部带有4K的EEPROM，严格来说，应该是4K的FLASH，它分为8个扇区，每个扇区有512个字节。读写数据只能按字节操作，擦除数据只能按扇区操作。 由于它掉电不易失的特性，可以用来存储程序运行过程中产生的用户数据，掉电可保存。

#### 3.关于中断

程序里面while（1）的作用：

- ```
  过程是这样的：
  程序一直在while（1）里面，直到定时器计满产生中断；
  产生中断后，执行中断服务程序 (中断中大部分是有重新对定时器赋值的命令的 )  中断程序完成后
  回到while（1），等待下一次中断，定时器继续计数；
  定时器产生中断，......反复
  ```

- ```
  当执行完TR1=1后，会先执行while(1),因为你初始化定时器时，设定的定时时间是50ms，只有等while(1)循环时间到了50ms，才会去执行中断服务程序。
  ```

- ```
  之所以有while(1)是为了使得程序一直在运行，所以才有中断操作的不断执行，否则程序只运行一次就终止啦。  就是确保一直执行
  ```

- ```
  在定时器计数的这段时间里，程序是一步一步向下执行。
  要执行定时器中断，要在程序开始就打开定时器中断。当产生溢出后，程序会直接跳到中断程序（不用加跳转指令）。当中断程序执行完毕后，程序会跳回到执行中断程序前的程序处继续运行。
  ```

#### 4.按键程序

> 按键按下，要进行消抖后二次判断
>
> 为什么？
>
> ![1570281911900](C:\Users\123\AppData\Roaming\Typora\typora-user-images\1570281911900.png)
>
> ![1570282004104](C:\Users\123\AppData\Roaming\Typora\typora-user-images\1570282004104.png)

- 用while是十分重要的，因为可以保证连续的按键

#### 5.PWM控制转速

- 基本原理：PWM是通过控制固定电压的直流电源开关频率，从而改变负载两端的电压，进而达到控制要求的一种电压调整方法。PwM可以应用在许多方面，如电机调速、温度控制、压力控制等。
- 在PWM驱动控制的调整系统中，按一个固定的频率来接通和断开电源，并根据需要改变一个周期内“接通”和“断开”时间的长短。通过改变直流电机电枢上电压的“占空比”来改变平均电压的大小，从而控制电动机的转速。因此，PWM又被称为“开关驱动装置”
- 通过控制定时器初值T0和T1，从而可以实现从8051的任意输出口输出不同占空比的脉冲波形.在对直流电动机电枢电压的控制和驱动中．目前广泛应用的是通过改变电机电枢电压接通时间与通电周期的比值f占空比)来控制电机的转速。这种方法称为脉冲宽度调制，即PWM控制。
- 当我们改变占空比D = t1/T时，就可以得到不同的电机平均速度，从而达到调速的目的。

## 功能

- 通过温度传感器实时监测外界环境温度，并显示在数码管上，用户可以自定义预设的上下限温度，当测得环境温度值在预设上下限值区间中时，此时风扇以3/4速转动；当温度升高并大于预设上限温度值时，风扇会自动调速，以全速转动；当温度降低并低于预设的下限温度值时，这时风扇电机自动停止转动。（目前设置的上限温度为30，下限温度为20）

- 图片

  - 背面焊接图

    ![1571108179267](C:\Users\123\AppData\Roaming\Typora\typora-user-images\1571108179267.png)

  - 上下限设置

    <img src="C:\Users\123\AppData\Roaming\Typora\typora-user-images\1571107833964.png" alt="1571107833964" style="zoom:67%;" />

    <img src="C:\Users\123\AppData\Roaming\Typora\typora-user-images\1571107872231.png" alt="1571107872231" style="zoom:67%;" />

  - 风扇转速在不同温度的不同（基于当前温度，第一次把上下限调整到7,20，一档旋转；第二次把上下限调整到7,13；二档旋转）

    <img src="C:\Users\123\AppData\Roaming\Typora\typora-user-images\1571108064141.png" alt="1571108064141" style="zoom:67%;" />

    <img src="C:\Users\123\AppData\Roaming\Typora\typora-user-images\1571108082904.png" alt="1571108082904" style="zoom:67%;" />

    